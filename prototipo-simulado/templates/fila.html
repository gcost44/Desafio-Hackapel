<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fila de Espera - Sistema SUS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="nav-icon">üè•</span>
                <span class="nav-title">Sistema SUS Automa√ß√£o</span>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link">üìä Dashboard</a>
                <a href="/importar" class="nav-link">üì• Importar</a>
                <a href="/fila" class="nav-link active">üë• Fila</a>
                <a href="/relatorios" class="nav-link">üìà Relat√≥rios</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h1>Fila de Espera Inteligente</h1>
            <button class="btn btn-primary" onclick="atualizarFila()">
                <span class="btn-icon">üîÑ</span> Atualizar
            </button>
        </div>

        <!-- Estat√≠sticas da Fila -->
        <div class="metrics-grid">
            <div class="metric-card metric-warning">
                <div class="metric-icon">‚è≥</div>
                <div class="metric-content">
                    <div class="metric-label">Em Espera</div>
                    <div class="metric-value" id="total-fila">0</div>
                    <div class="metric-subtitle">Pacientes aguardando</div>
                </div>
            </div>

            <div class="metric-card metric-danger">
                <div class="metric-icon">üö®</div>
                <div class="metric-content">
                    <div class="metric-label">Alta Prioridade</div>
                    <div class="metric-value" id="alta-prioridade">0</div>
                    <div class="metric-subtitle">Score acima de 50</div>
                </div>
            </div>

            <div class="metric-card metric-info">
                <div class="metric-icon">üìÖ</div>
                <div class="metric-content">
                    <div class="metric-label">Tempo M√©dio</div>
                    <div class="metric-value" id="tempo-medio">0</div>
                    <div class="metric-subtitle">Dias em espera</div>
                </div>
            </div>

            <div class="metric-card metric-success">
                <div class="metric-icon">üéØ</div>
                <div class="metric-content">
                    <div class="metric-label">Convoca√ß√µes Hoje</div>
                    <div class="metric-value" id="convocacoes-hoje">0</div>
                    <div class="metric-subtitle">Pacientes chamados</div>
                </div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="filter-bar">
            <input type="text" id="search-fila" class="search-input" placeholder="üîç Buscar paciente..." onkeyup="filtrarFila()">
            <select id="filter-especialidade" class="filter-select" onchange="filtrarFila()">
                <option value="">Todas especialidades</option>
                <option value="Cardiologista">Cardiologista</option>
                <option value="Oncologista">Oncologista</option>
                <option value="Ortopedista">Ortopedista</option>
                <option value="Neurologista">Neurologista</option>
                <option value="Pediatra">Pediatra</option>
            </select>
            <select id="filter-prioridade" class="filter-select" onchange="filtrarFila()">
                <option value="">Todas prioridades</option>
                <option value="alta">Alta (Score ‚â• 50)</option>
                <option value="media">M√©dia (Score 30-49)</option>
                <option value="baixa">Baixa (Score < 30)</option>
            </select>
        </div>

        <!-- Legenda de Cores -->
        <div class="legend-bar">
            <div class="legend-item">
                <span class="legend-color bg-danger"></span>
                <span>Alta Prioridade (Score ‚â• 50)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color bg-warning"></span>
                <span>M√©dia Prioridade (30-49)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color bg-success"></span>
                <span>Baixa Prioridade (< 30)</span>
            </div>
        </div>

        <!-- Fila de Espera -->
        <div class="table-container">
            <div class="table-header">
                <h2>Pacientes na Fila</h2>
                <span class="table-count" id="fila-count">0 pacientes</span>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nome</th>
                        <th>Idade</th>
                        <th>Especialidade</th>
                        <th>Tempo Espera</th>
                        <th>Score IA</th>
                        <th>Prioridade</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="fila-tbody">
                    <!-- Fila ser√° carregada via JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Explica√ß√£o do Score IA -->
        <div class="info-card">
            <h3>ü§ñ Como funciona o Score de Prioriza√ß√£o por IA?</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>üë¥ Idade (0-30 pontos)</strong>
                    <p>Idosos 80+ anos: 30 pontos<br>
                       Idosos 60-79 anos: 20 pontos<br>
                       Crian√ßas < 12 anos: 15 pontos</p>
                </div>
                <div class="info-item">
                    <strong>üè• Tipo de Exame (0-25 pontos)</strong>
                    <p>Oncologista: 25 pontos<br>
                       Cardiologista: 20 pontos<br>
                       Neurologista: 15 pontos</p>
                </div>
                <div class="info-item">
                    <strong>‚è±Ô∏è Tempo de Espera (0-15 pontos)</strong>
                    <p>Mais de 180 dias: 15 pontos<br>
                       90-180 dias: 10 pontos<br>
                       30-90 dias: 5 pontos</p>
                </div>
                <div class="info-item">
                    <strong>üéØ B√¥nus Especiais</strong>
                    <p>Paciente SUS priorit√°rio: +10<br>
                       Gestante: +8<br>
                       Pessoa com defici√™ncia: +7</p>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading-spinner" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
            <p>Carregando fila...</p>
        </div>
    </div>

    <!-- Modal Detalhes -->
    <div id="detalhes-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detalhes do Paciente</h2>
                <button class="modal-close" onclick="fecharModalDetalhes()">‚úï</button>
            </div>
            <div class="modal-body" id="detalhes-content">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/fila.js') }}"></script>
</body>
</html>
